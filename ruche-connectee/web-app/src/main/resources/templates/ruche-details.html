<!DOCTYPE html>
<html lang="fr" 
      xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<head>
    <title th:text="${'Détails - ' + ruche.nom + ' - BeeTrack'}">Détails Ruche - BeeTrack</title>
</head>

<body>
    <div layout:fragment="content" class="ruche-details-container">
        <!-- Navigation de retour -->
        <div class="breadcrumb-nav">
            <a href="/ruches" th:href="@{/ruches}" class="btn btn-secondary">
                <i data-lucide="chevron-left" class="me-2"></i>
                Retour aux ruches
            </a>
        </div>

        <!-- En-tête de la page -->
        <div class="page-header">
            <div class="header-content">
                <div class="header-info">
                    <h1 class="page-title" th:text="${ruche.nom}">Ruche #1</h1>
                    <p class="page-subtitle">
                        <i data-lucide="map-pin" class="me-1"></i>
                        <span th:text="${ruche.rucherNom ?: 'Aucun rucher assigné'}">Rucher Principal</span>
                    </p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="location.reload()">
                        <i data-lucide="refresh-cw" class="me-2"></i>
                        Actualiser
                    </button>
                    <a th:href="@{/ruches/{id}/editer(id=${ruche.id})}" class="btn btn-primary">
                        <i data-lucide="edit" class="me-2"></i>
                        Modifier
                    </a>
                </div>
            </div>
        </div>

        <!-- Statut et informations générales -->
        <div class="status-row">
            <div class="status-card">
                <div class="status-header">
                    <h3>Statut général</h3>
                    <span th:switch="${ruche.statut}" class="badge">
                        <span th:case="'active'" class="badge badge-success">
                            <i data-lucide="check-circle" class="me-1"></i>
                            Active
                        </span>
                        <span th:case="'inactive'" class="badge badge-warning">
                            <i data-lucide="pause-circle" class="me-1"></i>
                            Inactive
                        </span>
                        <span th:case="'alerte'" class="badge badge-danger">
                            <i data-lucide="alert-triangle" class="me-1"></i>
                            Alerte
                        </span>
                        <span th:case="*" class="badge badge-secondary">
                            <i data-lucide="circle" class="me-1"></i>
                            Indéterminé
                        </span>
                    </span>
                </div>
                <div class="status-info">
                    <p><strong>Type:</strong> <span th:text="${ruche.type ?: 'Non défini'}">Langstroth</span></p>
                    <p><strong>Numéro de série:</strong> <span th:text="${ruche.numeroSerie ?: 'Non défini'}">ESP32_001</span></p>
                    <p><strong>Créée le:</strong> <span th:text="${#temporals.format(ruche.dateCreation, 'dd/MM/yyyy')}">01/01/2024</span></p>
                </div>
            </div>

            <div class="status-card">
                <div class="status-header">
                    <h3>Dernière mesure</h3>
                    <span class="last-update" th:if="${ruche.derniereMesure != null}"
                          th:text="${#temporals.format(ruche.derniereMesure, 'dd/MM/yyyy HH:mm')}">
                        01/01/2024 14:30
                    </span>
                    <span class="last-update text-muted" th:unless="${ruche.derniereMesure != null}">
                        Aucune mesure
                    </span>
                </div>
                <div class="status-info">
                    <p><strong>Capteur:</strong> 
                        <span class="badge badge-success" th:if="${ruche.capteurConnecte}">
                            <i data-lucide="wifi" class="me-1"></i>
                            Connecté
                        </span>
                        <span class="badge badge-danger" th:unless="${ruche.capteurConnecte}">
                            <i data-lucide="wifi-off" class="me-1"></i>
                            Déconnecté
                        </span>
                    </p>
                    <p><strong>Qualité signal:</strong> 
                        <span th:switch="${ruche.qualiteSignal}">
                            <span th:case="'excellent'" class="text-success">Excellent</span>
                            <span th:case="'bon'" class="text-success">Bon</span>
                            <span th:case="'moyen'" class="text-warning">Moyen</span>
                            <span th:case="'faible'" class="text-danger">Faible</span>
                            <span th:case="*" class="text-muted">Inconnu</span>
                        </span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Métriques actuelles -->
        <div class="metrics-grid">
            <div class="metric-card temperature">
                <div class="metric-header">
                    <i data-lucide="thermometer" class="metric-icon"></i>
                    <h3>Température</h3>
                </div>
                <div class="metric-value">
                    <span class="value" th:text="${ruche.temperature != null ? ruche.temperature + '°C' : 'N/A'}">24.5°C</span>
                    <span class="trend" th:if="${ruche.tendanceTemperature != null}">
                        <i th:class="${ruche.tendanceTemperature == 'up' ? 'data-lucide=trending-up text-red-500' : 
                                     ruche.tendanceTemperature == 'down' ? 'data-lucide=trending-down text-blue-500' : 
                                     'data-lucide=minus text-gray-500'}"></i>
                    </span>
                </div>
                <div class="metric-info">
                    <small class="metric-range">Plage normale: 20-35°C</small>
                </div>
            </div>

            <div class="metric-card humidity">
                <div class="metric-header">
                    <i data-lucide="droplets" class="metric-icon"></i>
                    <h3>Humidité</h3>
                </div>
                <div class="metric-value">
                    <span class="value" th:text="${ruche.humidite != null ? ruche.humidite + '%' : 'N/A'}">65%</span>
                    <span class="trend" th:if="${ruche.tendanceHumidite != null}">
                        <i th:class="${ruche.tendanceHumidite == 'up' ? 'data-lucide=trending-up text-blue-500' : 
                                     ruche.tendanceHumidite == 'down' ? 'data-lucide=trending-down text-red-500' : 
                                     'data-lucide=minus text-gray-500'}"></i>
                    </span>
                </div>
                <div class="metric-info">
                    <small class="metric-range">Plage normale: 50-80%</small>
                </div>
            </div>

            <div class="metric-card weight">
                <div class="metric-header">
                    <i data-lucide="scale" class="metric-icon"></i>
                    <h3>Poids</h3>
                </div>
                <div class="metric-value">
                    <span class="value" th:text="${ruche.poids != null ? ruche.poids + ' kg' : 'N/A'}">45.2 kg</span>
                    <span class="trend" th:if="${ruche.tendancePoids != null}">
                        <i th:class="${ruche.tendancePoids == 'up' ? 'data-lucide=trending-up text-green-500' : 
                                     ruche.tendancePoids == 'down' ? 'data-lucide=trending-down text-red-500' : 
                                     'data-lucide=minus text-gray-500'}"></i>
                    </span>
                </div>
                <div class="metric-info">
                    <small class="metric-range">Variation: +0.5kg cette semaine</small>
                </div>
            </div>

            <div class="metric-card activity">
                <div class="metric-header">
                    <i data-lucide="activity" class="metric-icon"></i>
                    <h3>Activité</h3>
                </div>
                <div class="metric-value">
                    <span class="value" th:text="${ruche.activite != null ? ruche.activite : 'N/A'}">Normale</span>
                </div>
                <div class="metric-info">
                    <small class="metric-range">Basé sur les vibrations</small>
                </div>
            </div>
        </div>

        <!-- Graphiques -->
        <div class="charts-section">
            <div class="charts-header">
                <h2>Historique des mesures</h2>
                <div class="chart-controls">
                    <select id="chartPeriod" class="form-control">
                        <option value="24h">24 heures</option>
                        <option value="7d" selected>7 jours</option>
                        <option value="30d">30 jours</option>
                        <option value="1y">1 an</option>
                    </select>
                </div>
            </div>

            <div class="charts-grid">
                <!-- Graphique de température -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>
                            <i data-lucide="thermometer" class="me-2"></i>
                            Température
                        </h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="temperatureChart"></canvas>
                    </div>
                </div>

                <!-- Graphique d'humidité -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>
                            <i data-lucide="droplets" class="me-2"></i>
                            Humidité
                        </h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="humidityChart"></canvas>
                    </div>
                </div>

                <!-- Graphique de poids -->
                <div class="chart-card full-width">
                    <div class="chart-header">
                        <h3>
                            <i data-lucide="scale" class="me-2"></i>
                            Évolution du poids
                        </h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="weightChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alertes et événements -->
        <div class="events-section">
            <div class="row">
                <!-- Alertes actives -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i data-lucide="alert-triangle" class="me-2"></i>
                                Alertes actives
                            </h3>
                        </div>
                        <div class="alerts-list">
                            <div th:if="${#lists.isEmpty(alertes)}" class="text-center text-muted p-4">
                                <i data-lucide="check-circle" style="width: 3rem; height: 3rem; color: #10b981;"></i>
                                <p class="mt-2">Aucune alerte active</p>
                            </div>
                            <div th:each="alerte : ${alertes}" class="alert-item" th:classappend="${'alert-' + alerte.niveau}">
                                <div class="alert-icon">
                                    <i th:switch="${alerte.type}"
                                       th:case="'temperature'" data-lucide="thermometer"
                                       th:case="'humidite'" data-lucide="droplets"
                                       th:case="'poids'" data-lucide="scale"
                                       th:case="'activite'" data-lucide="activity"
                                       th:case="*" data-lucide="alert-triangle"></i>
                                </div>
                                <div class="alert-content">
                                    <p class="alert-title" th:text="${alerte.titre}">Température élevée</p>
                                    <p class="alert-description" th:text="${alerte.description}">La température dépasse 35°C</p>
                                    <small class="alert-time" th:text="${#temporals.format(alerte.dateCreation, 'dd/MM/yyyy HH:mm')}">01/01/2024 14:30</small>
                                </div>
                                <div class="alert-actions">
                                    <button class="btn btn-sm btn-secondary" 
                                            onclick="marquerAlerteResolue(this)"
                                            th:data-alerte-id="${alerte.id}">
                                        <i data-lucide="check"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Historique des événements -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i data-lucide="clock" class="me-2"></i>
                                Événements récents
                            </h3>
                        </div>
                        <div class="events-list">
                            <div th:if="${#lists.isEmpty(evenements)}" class="text-center text-muted p-4">
                                Aucun événement récent
                            </div>
                            <div th:each="evenement : ${evenements}" class="event-item">
                                <div class="event-icon" th:classappend="${'bg-' + evenement.couleur}">
                                    <i th:attr="data-lucide=${evenement.icone}" data-lucide="circle"></i>
                                </div>
                                <div class="event-content">
                                    <p class="event-title" th:text="${evenement.titre}">Données synchronisées</p>
                                    <small class="event-time" th:text="${#temporals.format(evenement.dateCreation, 'dd/MM/yyyy HH:mm')}">01/01/2024 14:30</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions et maintenance -->
        <div class="actions-section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i data-lucide="settings" class="me-2"></i>
                        Actions et maintenance
                    </h3>
                </div>
                <div class="actions-grid">
                    <button class="action-btn" onclick="exporterDonnees()">
                        <i data-lucide="download" class="me-2"></i>
                        Exporter les données
                    </button>
                    <button class="action-btn" onclick="calibrerCapteurs()">
                        <i data-lucide="settings" class="me-2"></i>
                        Calibrer les capteurs
                    </button>
                    <button class="action-btn" onclick="reinitialiserCapteurs()">
                        <i data-lucide="refresh-cw" class="me-2"></i>
                        Redémarrer les capteurs
                    </button>
                    <button class="action-btn danger" onclick="confirmerSuppressionRuche()">
                        <i data-lucide="trash-2" class="me-2"></i>
                        Supprimer la ruche
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmation suppression -->
    <div class="modal fade" id="confirmerSuppressionRucheModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger">
                        <i data-lucide="alert-triangle" class="me-2"></i>
                        Confirmer la suppression
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                
                <div class="modal-body">
                    <p>Êtes-vous sûr de vouloir supprimer définitivement la ruche <strong th:text="${ruche.nom}">Ruche #1</strong> ?</p>
                    <div class="alert alert-warning">
                        <i data-lucide="alert-triangle" class="me-2"></i>
                        Cette action est irréversible. Toutes les données historiques seront également supprimées.
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <form th:action="@{/ruches/{id}/supprimer(id=${ruche.id})}" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-danger">
                            <i data-lucide="trash-2" class="me-2"></i>
                            Supprimer définitivement
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Styles spécifiques aux détails ruche -->
    <th:block layout:fragment="styles">
        <style>
            .breadcrumb-nav {
                margin-bottom: 1rem;
            }

            .page-header {
                margin-bottom: 2rem;
            }

            .header-content {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
            }

            .header-actions {
                display: flex;
                gap: 0.5rem;
            }

            .status-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
                margin-bottom: 2rem;
            }

            .status-card {
                background: white;
                border-radius: 0.75rem;
                padding: 1.5rem;
                box-shadow: var(--shadow-primary);
            }

            .status-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
            }

            .status-header h3 {
                margin: 0;
                font-size: 1.1rem;
                font-weight: 600;
            }

            .last-update {
                font-size: 0.875rem;
                color: #64748b;
            }

            .metrics-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
                margin-bottom: 2rem;
            }

            .metric-card {
                background: white;
                border-radius: 0.75rem;
                padding: 1.5rem;
                box-shadow: var(--shadow-primary);
                text-align: center;
            }

            .metric-card.temperature { border-left: 4px solid #ef4444; }
            .metric-card.humidity { border-left: 4px solid #3b82f6; }
            .metric-card.weight { border-left: 4px solid #10b981; }
            .metric-card.activity { border-left: 4px solid #8b5cf6; }

            .metric-header {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                margin-bottom: 1rem;
            }

            .metric-icon {
                width: 1.5rem;
                height: 1.5rem;
            }

            .metric-value {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                margin-bottom: 0.5rem;
            }

            .metric-value .value {
                font-size: 2rem;
                font-weight: 700;
                color: #1e293b;
            }

            .metric-range {
                color: #64748b;
            }

            .charts-section {
                margin-bottom: 2rem;
            }

            .charts-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.5rem;
            }

            .charts-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
            }

            .charts-grid .full-width {
                grid-column: 1 / -1;
            }

            .chart-card {
                background: white;
                border-radius: 0.75rem;
                padding: 1.5rem;
                box-shadow: var(--shadow-primary);
            }

            .chart-header {
                margin-bottom: 1rem;
            }

            .chart-container {
                position: relative;
                height: 300px;
            }

            .events-section {
                margin-bottom: 2rem;
            }

            .alerts-list, .events-list {
                max-height: 400px;
                overflow-y: auto;
            }

            .alert-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                border-bottom: 1px solid #e2e8f0;
                border-left: 4px solid transparent;
            }

            .alert-item.alert-high { border-left-color: #ef4444; }
            .alert-item.alert-medium { border-left-color: #f59e0b; }
            .alert-item.alert-low { border-left-color: #10b981; }

            .alert-icon {
                width: 2rem;
                height: 2rem;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #f1f5f9;
                color: #64748b;
            }

            .alert-content {
                flex: 1;
            }

            .alert-title {
                font-weight: 600;
                margin: 0 0 0.25rem 0;
            }

            .alert-description {
                margin: 0 0 0.25rem 0;
                color: #64748b;
            }

            .alert-time {
                color: #94a3b8;
            }

            .event-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                border-bottom: 1px solid #e2e8f0;
            }

            .event-icon {
                width: 2rem;
                height: 2rem;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
            }

            .actions-section .card {
                background: white;
                border-radius: 0.75rem;
                padding: 1.5rem;
                box-shadow: var(--shadow-primary);
            }

            .actions-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }

            .action-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 1rem;
                border: 2px solid #e2e8f0;
                border-radius: 0.5rem;
                background: white;
                color: #1e293b;
                text-decoration: none;
                transition: all 0.2s ease;
                cursor: pointer;
                font-weight: 500;
            }

            .action-btn:hover {
                border-color: var(--primary-amber-400);
                background: var(--primary-amber-50);
            }

            .action-btn.danger {
                border-color: #fecaca;
                color: #dc2626;
            }

            .action-btn.danger:hover {
                border-color: #dc2626;
                background: #fef2f2;
            }

            @media (max-width: 768px) {
                .header-content {
                    flex-direction: column;
                    gap: 1rem;
                }

                .status-row {
                    grid-template-columns: 1fr;
                }

                .metrics-grid {
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                }

                .charts-grid {
                    grid-template-columns: 1fr;
                }

                .actions-grid {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    </th:block>

    <!-- Scripts spécifiques aux détails ruche -->
    <th:block layout:fragment="scripts">
        <script>
            // Données pour les graphiques (vous devrez les récupérer depuis le serveur)
            const rucheData = {
                id: /*[[${ruche.id}]]*/ '1',
                nom: /*[[${ruche.nom}]]*/ 'Ruche #1'
            };

            function confirmerSuppressionRuche() {
                const modal = new bootstrap.Modal(document.getElementById('confirmerSuppressionRucheModal'));
                modal.show();
            }

            function marquerAlerteResolue(button) {
                const alerteId = button.getAttribute('data-alerte-id');
                
                // Appel AJAX pour marquer l'alerte comme résolue
                fetch(`/api/alertes/${alerteId}/resoudre`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Masquer l'alerte
                        button.closest('.alert-item').style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Erreur lors de la résolution de l\'alerte:', error);
                });
            }

            function exporterDonnees() {
                window.open(`/api/ruches/${rucheData.id}/export`, '_blank');
            }

            function calibrerCapteurs() {
                if (confirm('Voulez-vous vraiment calibrer les capteurs ? Cette opération peut prendre quelques minutes.')) {
                    fetch(`/api/ruches/${rucheData.id}/calibrer`, {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message || 'Calibration démarrée avec succès.');
                    })
                    .catch(error => {
                        console.error('Erreur lors de la calibration:', error);
                        alert('Erreur lors de la calibration des capteurs.');
                    });
                }
            }

            function reinitialiserCapteurs() {
                if (confirm('Voulez-vous vraiment redémarrer les capteurs ? La ruche sera temporairement déconnectée.')) {
                    fetch(`/api/ruches/${rucheData.id}/redemarrer`, {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message || 'Redémarrage des capteurs en cours...');
                    })
                    .catch(error => {
                        console.error('Erreur lors du redémarrage:', error);
                        alert('Erreur lors du redémarrage des capteurs.');
                    });
                }
            }

            // Gérer le changement de période pour les graphiques
            document.getElementById('chartPeriod').addEventListener('change', function(e) {
                const period = e.target.value;
                // Recharger les graphiques avec la nouvelle période
                loadChartData(period);
            });

            function loadChartData(period = '7d') {
                // Récupérer les données depuis l'API
                fetch(`/api/ruches/${rucheData.id}/donnees?periode=${period}`)
                    .then(response => response.json())
                    .then(data => {
                        updateCharts(data);
                    })
                    .catch(error => {
                        console.error('Erreur lors du chargement des données:', error);
                    });
            }

            function updateCharts(data) {
                // Créer ou mettre à jour les graphiques
                if (typeof Chart !== 'undefined') {
                    createTemperatureChart(data.temperature);
                    createHumidityChart(data.humidite);
                    createWeightChart(data.poids);
                }
            }

            function createTemperatureChart(data) {
                const ctx = document.getElementById('temperatureChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.labels || [],
                            datasets: [{
                                label: 'Température (°C)',
                                data: data.values || [],
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    title: {
                                        display: true,
                                        text: 'Température (°C)'
                                    }
                                }
                            }
                        }
                    });
                }
            }

            function createHumidityChart(data) {
                const ctx = document.getElementById('humidityChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.labels || [],
                            datasets: [{
                                label: 'Humidité (%)',
                                data: data.values || [],
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    min: 0,
                                    max: 100,
                                    title: {
                                        display: true,
                                        text: 'Humidité (%)'
                                    }
                                }
                            }
                        }
                    });
                }
            }

            function createWeightChart(data) {
                const ctx = document.getElementById('weightChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.labels || [],
                            datasets: [{
                                label: 'Poids (kg)',
                                data: data.values || [],
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    title: {
                                        display: true,
                                        text: 'Poids (kg)'
                                    }
                                }
                            }
                        }
                    });
                }
            }

            // Charger les données initiales au chargement de la page
            document.addEventListener('DOMContentLoaded', function() {
                loadChartData();
            });
        </script>
    </th:block>
</body>
</html> 