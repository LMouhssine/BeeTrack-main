<!DOCTYPE html>
<html lang="fr" 
      xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<head>
    <title>Tableau de bord - BeeTrack</title>
    <meta name="description" content="Tableau de bord professionnel de votre syst√®me de gestion de ruches connect√©es">
</head>

<body>
    <div layout:fragment="content" class="dashboard-container">
        <!-- Header moderne du dashboard -->
        <div class="dashboard-header mb-8 fade-in" style="animation-delay: 0.1s;">
            <div class="welcome-section">
                <div class="greeting-container">
                    <h1 class="dashboard-title">
                        <span class="greeting-text">Bonjour</span>
                        <span class="user-name" th:text="${#authentication != null ? #authentication.name : 'Apiculteur'}">Apiculteur</span> 
                        <span class="wave-emoji">üëã</span>
                    </h1>
                </div>
                <p class="dashboard-subtitle">
                    <span class="subtitle-main">Aper√ßu de vos ruches connect√©es</span>
                    <span class="last-update" th:text="${'‚Ä¢ Derni√®re mise √† jour : ' + #dates.format(#dates.createNow(), 'HH:mm')}">‚Ä¢ Derni√®re mise √† jour : 14:30</span>
                </p>
            </div>
            <div class="dashboard-actions">
                <button class="btn btn-secondary" data-refresh="dashboard" title="Actualiser les donn√©es">
                    <i data-lucide="refresh-cw" class="me-2"></i>
                    <span>Actualiser</span>
                </button>
                <button class="btn btn-primary" onclick="location.href='/ruches/nouvelle'" title="Ajouter une nouvelle ruche">
                    <i data-lucide="plus" class="me-2"></i>
                    <span>Nouvelle ruche</span>
                </button>
            </div>
        </div>

        <!-- Statistiques principales avec design moderne -->
        <div class="stats-grid mb-8">
            <!-- Total des ruches -->
            <div class="stat-card scale-in" style="animation-delay: 0.2s;">
                <div class="stat-header">
                    <div class="stat-content">
                        <h3 class="stat-value" th:text="${totalRuches ?: 0}" data-stat="totalRuches">0</h3>
                        <p class="stat-label">
                            <i data-lucide="hexagon" class="stat-label-icon"></i>
                            <span>Ruches totales</span>
                        </p>
                    </div>
                    <div class="stat-icon bg-amber-500">
                        <i data-lucide="hexagon"></i>
                    </div>
                </div>
                <div class="stat-footer">
                    <div class="stat-detail">
                        <span class="stat-detail-value" th:text="${ruchesEnService ?: 0}">0</span>
                        <span class="stat-detail-label">en service</span>
                    </div>
                    <div class="stat-trend positive">
                        <i data-lucide="trending-up"></i>
                        <span>+2.3%</span>
                    </div>
                </div>
            </div>

            <!-- Total des ruchers -->
            <div class="stat-card scale-in" style="animation-delay: 0.3s;">
                <div class="stat-header">
                    <div class="stat-content">
                        <h3 class="stat-value" th:text="${totalRuchers ?: 0}" data-stat="totalRuchers">0</h3>
                        <p class="stat-label">
                            <i data-lucide="map-pin" class="stat-label-icon"></i>
                            <span>Ruchers actifs</span>
                        </p>
                    </div>
                    <div class="stat-icon bg-green-500">
                        <i data-lucide="map-pin"></i>
                    </div>
                </div>
                <div class="stat-footer">
                    <div class="stat-detail">
                        <span class="stat-detail-value">98%</span>
                        <span class="stat-detail-label">disponibilit√©</span>
                    </div>
                    <div class="stat-trend positive">
                        <i data-lucide="trending-up"></i>
                        <span>+1.2%</span>
                    </div>
                </div>
            </div>

            <!-- Alertes actives -->
            <div class="stat-card scale-in" style="animation-delay: 0.4s;">
                <div class="stat-header">
                    <div class="stat-content">
                        <h3 class="stat-value text-red-600" th:text="${alertesActives ?: 0}" data-stat="alertesActives">0</h3>
                        <p class="stat-label">
                            <i data-lucide="alert-triangle" class="stat-label-icon"></i>
                            <span>Alertes actives</span>
                        </p>
                    </div>
                    <div class="stat-icon bg-red-500">
                        <i data-lucide="alert-triangle"></i>
                    </div>
                </div>
                <div class="stat-footer">
                    <div class="stat-detail">
                        <span class="stat-detail-value">2</span>
                        <span class="stat-detail-label">critiques</span>
                    </div>
                    <div class="stat-trend negative">
                        <i data-lucide="trending-down"></i>
                        <span>-15%</span>
                    </div>
                </div>
            </div>

            <!-- Performance globale -->
            <div class="stat-card scale-in" style="animation-delay: 0.5s;">
                <div class="stat-header">
                    <div class="stat-content">
                        <h3 class="stat-value text-blue-600">98.5%</h3>
                        <p class="stat-label">
                            <i data-lucide="activity" class="stat-label-icon"></i>
                            <span>Performance</span>
                        </p>
                    </div>
                    <div class="stat-icon bg-blue-500">
                        <i data-lucide="trending-up"></i>
                    </div>
                </div>
                <div class="stat-footer">
                    <div class="stat-detail">
                        <span class="stat-detail-value">24.2¬∞C</span>
                        <span class="stat-detail-label">temp. moy.</span>
                    </div>
                    <div class="stat-trend positive">
                        <i data-lucide="thermometer"></i>
                        <span>Optimal</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions rapides modernis√©es -->
        <div class="card fade-in" style="animation-delay: 0.6s;">
            <div class="card-header">
                <div class="card-header-content">
                    <h2 class="card-title">
                        <i data-lucide="zap" class="me-2"></i>
                        <span>Actions rapides</span>
                    </h2>
                    <div class="card-subtitle">
                        Raccourcis vers les t√¢ches les plus courantes
                    </div>
                </div>
                <div class="card-actions">
                    <button class="btn btn-sm btn-secondary" onclick="BeeTrack.refreshActions()" title="Actualiser les actions">
                        <i data-lucide="refresh-cw"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="quick-actions-grid">
                    <a href="/ruches/nouvelle" th:href="@{/ruches/nouvelle}" class="quick-action-card primary">
                        <div class="quick-action-background"></div>
                        <div class="quick-action-icon">
                            <i data-lucide="plus"></i>
                        </div>
                        <div class="quick-action-content">
                            <h4>Ajouter une ruche</h4>
                            <p>Enregistrer une nouvelle ruche dans le syst√®me</p>
                        </div>
                        <div class="quick-action-arrow">
                            <i data-lucide="arrow-right"></i>
                        </div>
                    </a>
                    
                    <a href="/ruchers" th:href="@{/ruchers}" class="quick-action-card secondary">
                        <div class="quick-action-background"></div>
                        <div class="quick-action-icon">
                            <i data-lucide="map-pin"></i>
                        </div>
                        <div class="quick-action-content">
                            <h4>G√©rer les ruchers</h4>
                            <p>Organiser et configurer vos emplacements</p>
                        </div>
                        <div class="quick-action-arrow">
                            <i data-lucide="arrow-right"></i>
                        </div>
                    </a>
                    
                    <a href="/statistiques" th:href="@{/statistiques}" class="quick-action-card tertiary">
                        <div class="quick-action-background"></div>
                        <div class="quick-action-icon">
                            <i data-lucide="bar-chart-3"></i>
                        </div>
                        <div class="quick-action-content">
                            <h4>Voir les statistiques</h4>
                            <p>Analyser les performances et tendances</p>
                        </div>
                        <div class="quick-action-arrow">
                            <i data-lucide="arrow-right"></i>
                        </div>
                    </a>
                    
                    <a href="/alertes" th:href="@{/alertes}" class="quick-action-card quaternary">
                        <div class="quick-action-background"></div>
                        <div class="quick-action-icon">
                            <i data-lucide="alert-triangle"></i>
                        </div>
                        <div class="quick-action-content">
                            <h4>G√©rer les alertes</h4>
                            <p>Surveiller et traiter les notifications</p>
                        </div>
                        <div class="quick-action-arrow">
                            <i data-lucide="arrow-right"></i>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- Grille principale du dashboard -->
        <div class="dashboard-main-grid mt-8">
            <!-- Section des ruches r√©centes -->
            <div class="dashboard-charts">
                <div class="card">
                    <div class="card-header">
                        <div class="card-header-content">
                            <h2 class="card-title">
                                <i data-lucide="hexagon" class="me-2"></i>
                                <span>Ruches r√©centes</span>
                            </h2>
                            <div class="card-subtitle">
                                Derni√®res activit√©s et mises √† jour
                            </div>
                        </div>
                        <div class="card-actions">
                            <a href="/ruches" th:href="@{/ruches}" class="btn btn-sm btn-secondary">
                                <i data-lucide="external-link" class="me-1"></i>
                                <span>Voir tout</span>
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="ruches-list" th:if="${not #lists.isEmpty(ruches)}">
                            <div class="ruche-item" th:each="ruche : ${ruches}" th:style="animation-delay: ${rucheStat.index * 0.1}s">
                                <div class="ruche-avatar">
                                    <i data-lucide="hexagon"></i>
                                </div>
                                <div class="ruche-info">
                                    <div class="ruche-name" th:text="${ruche.nom}">Ruche Alpha</div>
                                    <div class="ruche-location" th:text="${ruche.rucher?.nom ?: 'Emplacement non d√©fini'}">Rucher Principal</div>
                                </div>
                                <div class="ruche-metrics">
                                    <div class="metric">
                                        <i data-lucide="thermometer"></i>
                                        <span th:text="${ruche.temperature ?: 'N/A'}">24.5¬∞C</span>
                                    </div>
                                    <div class="metric">
                                        <i data-lucide="droplets"></i>
                                        <span th:text="${ruche.humidite ?: 'N/A'}">65%</span>
                                    </div>
                                </div>
                                <div class="status-badge" th:classappend="${ruche.actif ? 'status-success' : 'status-inactive'}">
                                    <i data-lucide="circle"></i>
                                    <span th:text="${ruche.actif ? 'Actif' : 'Inactif'}">Actif</span>
                                </div>
                            </div>
                        </div>
                        <div class="empty-state" th:if="${#lists.isEmpty(ruches)}">
                            <div class="empty-icon">
                                <i data-lucide="hexagon"></i>
                            </div>
                            <h3>Aucune ruche trouv√©e</h3>
                            <p>Commencez par ajouter votre premi√®re ruche pour voir les donn√©es ici.</p>
                            <a href="/ruches/nouvelle" th:href="@{/ruches/nouvelle}" class="btn btn-primary">
                                <i data-lucide="plus" class="me-2"></i>
                                <span>Ajouter une ruche</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar avec m√©t√©o et activit√©s -->
            <div class="dashboard-sidebar">
                <!-- Carte m√©t√©o -->
                <div class="card weather-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i data-lucide="cloud-sun" class="me-2"></i>
                            <span>M√©t√©o locale</span>
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="weather-current">
                            <div class="weather-temp">
                                <span class="temp-value">22¬∞C</span>
                                <span class="weather-condition">Ensoleill√©</span>
                            </div>
                            <div class="weather-icon">
                                <i data-lucide="sun"></i>
                            </div>
                        </div>
                        <div class="weather-details">
                            <div class="weather-detail">
                                <i data-lucide="wind"></i>
                                <span>12 km/h</span>
                            </div>
                            <div class="weather-detail">
                                <i data-lucide="droplets"></i>
                                <span>45%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activit√©s r√©centes -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i data-lucide="activity" class="me-2"></i>
                            <span>Activit√©s r√©centes</span>
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="activity-feed">
                            <div class="activity-item">
                                <div class="activity-avatar success">
                                    <i data-lucide="check-circle"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Ruche Alpha mise √† jour</div>
                                    <div class="activity-description">Temp√©rature normale, 24.5¬∞C</div>
                                    <div class="activity-time">Il y a 5 minutes</div>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-avatar warning">
                                    <i data-lucide="alert-triangle"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Alerte d√©tect√©e</div>
                                    <div class="activity-description">Humidit√© √©lev√©e sur Ruche Beta</div>
                                    <div class="activity-time">Il y a 15 minutes</div>
                                </div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-avatar info">
                                    <i data-lucide="plus-circle"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Nouvelle ruche ajout√©e</div>
                                    <div class="activity-description">Ruche Gamma enregistr√©e</div>
                                    <div class="activity-time">Il y a 1 heure</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts sp√©cifiques au dashboard -->
    <th:block layout:fragment="scripts">
        <script>
            // Initialisation du dashboard
            document.addEventListener('DOMContentLoaded', function() {
                // Animation des statistiques
                const statValues = document.querySelectorAll('.stat-value');
                statValues.forEach(stat => {
                    const finalValue = parseInt(stat.textContent);
                    animateCounter(stat, 0, finalValue, 1000);
                });
                
                // Actualisation automatique
                setInterval(() => {
                    // Actualiser les donn√©es toutes les 30 secondes
                    console.log('Actualisation automatique des donn√©es...');
                }, 30000);
            });
            
            // Fonction d'animation des compteurs
            function animateCounter(element, start, end, duration) {
                const range = end - start;
                const increment = range / (duration / 16);
                let current = start;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= end) {
                        current = end;
                        clearInterval(timer);
                    }
                    element.textContent = Math.floor(current);
                }, 16);
            }
        </script>
    </th:block>
</body>
</html>
